import{r as c,j as e}from"./main-BUCsxAGv.js";import{a as A}from"./index-Dq7h7Pqt.js";import{M,T,F as k,E as R,P as E,p as H,a as N,c as $}from"./EditControl-BGFO8qJ7.js";const G=()=>{const[n,g]=c.useState([]),[m,u]=c.useState(null),[f,y]=c.useState(null),[v,x]=c.useState(null),[P,h]=c.useState(!1),b="field_1";localStorage.getItem("access_token");const w=async(i,o)=>{try{return(await A.get(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${i}&lon=${o}`)).data.display_name}catch(s){return console.error("Reverse geocode error:",s),null}},C=async i=>{const{layerType:o,layer:s}=i;if(console.log("layerType:",o),o==="polygon"||o==="rectangle"){const r=s.getLatLngs()[0].map(l=>({lat:l.lat,lng:l.lng}));g(r),h(!0);const t=[...r,r[0]],a=H([t.map(l=>[l.lat,l.lng])]),p=N(a)/4046.86,F=$(a),[j,_]=F.geometry.coordinates,L=await w(j,_);u({locationName:L,center:[j,_],area:+p.toFixed(2)});return}if(o==="marker"){if(!P){alert("Please draw the field boundary first.");return}const{lat:S,lng:r}=s.getLatLng(),t={lat:S,lng:r};if(!f){console.log("Setting Field Access Point:",t),y(t);return}if(!v){console.log("Setting Robot Home:",t);const a=f,d=t;if(x(t),a&&d&&n.length>0&&m){const p={field_name:b,location:m.locationName,robot_home:d,field_access_point:a,field_boundary:n};console.log("Sending field data:",p),y(null),x(null),h(!1),g([]),u(null)}return}}};return e.jsx("div",{className:"flex",children:e.jsxs(M,{center:[17.385,78.4867],zoom:13,style:{height:"550px",width:"100%"},children:[e.jsx(T,{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"}),e.jsxs(k,{children:[e.jsx(R,{position:"topleft",onCreated:C,draw:{rectangle:!0,circle:!1,circlemarker:!1,polygon:!0,marker:!0,polyline:!1}}),n.length>0&&e.jsx(E,{positions:n})]})]})})},D=function(){return e.jsxs("div",{children:[e.jsx("h1",{className:"text-white",children:"Teleop"}),e.jsx(G,{})]})};export{D as component};
